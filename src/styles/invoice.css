/**
 * Invoice Styling System - Simple CSS Isolation Approach
 *
 * Uses CSS isolation to completely separate invoices from Tailwind dark mode.
 * All templates use inline styles, so we only need isolation - no overrides needed.
 */

/* ============================================================================
   BASE: Invoice Container Isolation
   ============================================================================ */

/**
 * Core isolation class - creates a completely isolated rendering context
 * This prevents any external styles (including Tailwind dark mode) from affecting invoices
 */
.invoice-container {
  isolation: isolate;
  contain: style;
  color-scheme: light;
  /* Force light color scheme to prevent Tailwind dark mode from affecting the container */
  /* Templates use inline styles, so no forced colors needed */
}

/* Prevent Tailwind dark mode from affecting the container itself */
@media (prefers-color-scheme: dark) {

  .invoice-container,
  .pdf-generation-temp {
    /* Ensure container doesn't inherit dark mode background */
    background-color: transparent !important;
    background: transparent !important;
  }

}

/* PDF generation - same isolation */
.pdf-generation-temp {
  isolation: isolate;
  contain: style;
  color-scheme: light;
  /* Force light color scheme to prevent Tailwind dark mode from affecting PDF generation */
}

/* ============================================================================
   TAILWIND DARK MODE PROTECTION
   ============================================================================ */

/**
 * Prevent Tailwind dark mode from affecting invoice containers
 * Tailwind's @media (prefers-color-scheme: dark) can still apply inside isolated containers
 * We need to explicitly override any Tailwind dark mode rules
 */
@media (prefers-color-scheme: dark) {

  /* ========================================================================
     DEFAULT DARK TEXT RULE - Must come FIRST before white-on-black rules
     ======================================================================== */

  /**
   * CRITICAL: Force dark text on all elements without explicit color styles
   * This prevents Tailwind dark mode from applying white text to elements
   * that don't have explicit colors, which causes white-on-white text issues.
   * 
   * This rule excludes:
   * - Elements with black backgrounds (handled by rules below)
   * - Elements with explicit color styles (should keep their colors)
   */
  .invoice-container *:not([style*="background: #000"]):not([style*="background:#000"]):not([style*="background: #000000"]):not([style*="background:#000000"]):not([style*="background-color: #000"]):not([style*="background-color:#000"]):not([style*="background-color: #000000"]):not([style*="background-color:#000000"]):not([style*="background: rgb(0, 0, 0)"]):not([style*="background:rgb(0, 0, 0)"]):not([style*="color:"]):not([style*="color "]) {
    color: #000000 !important;
  }

  .pdf-generation-temp *:not([style*="background: #000"]):not([style*="background:#000"]):not([style*="background: #000000"]):not([style*="background:#000000"]):not([style*="background-color: #000"]):not([style*="background-color:#000"]):not([style*="background-color: #000000"]):not([style*="background-color:#000000"]):not([style*="background: rgb(0, 0, 0)"]):not([style*="background:rgb(0, 0, 0)"]):not([style*="color:"]):not([style*="color "]) {
    color: #000000 !important;
  }

  /* ========================================================================
     WHITE-ON-BLACK PROTECTION RULES - Must come AFTER default dark text rule
     ======================================================================== */

  /* CRITICAL: Protect elements with black backgrounds and white text */
  /* These are common in templates like Brutalist */
  /* Force black backgrounds to stay black */
  .invoice-container [style*="background: #000"],
  .invoice-container [style*="background:#000"],
  .invoice-container [style*="background: #000000"],
  .invoice-container [style*="background:#000000"],
  .invoice-container [style*="background-color: #000"],
  .invoice-container [style*="background-color:#000"],
  .invoice-container [style*="background-color: #000000"],
  .invoice-container [style*="background-color:#000000"],
  .invoice-container [style*="background: rgb(0, 0, 0)"],
  .invoice-container [style*="background:rgb(0, 0, 0)"],
  .pdf-generation-temp [style*="background: #000"],
  .pdf-generation-temp [style*="background:#000"],
  .pdf-generation-temp [style*="background: #000000"],
  .pdf-generation-temp [style*="background:#000000"],
  .pdf-generation-temp [style*="background-color: #000"],
  .pdf-generation-temp [style*="background-color:#000"],
  .pdf-generation-temp [style*="background-color: #000000"],
  .pdf-generation-temp [style*="background-color:#000000"],
  .pdf-generation-temp [style*="background: rgb(0, 0, 0)"],
  .pdf-generation-temp [style*="background:rgb(0, 0, 0)"] {
    background-color: #000000 !important;
    background: #000000 !important;
  }

  /* Force white text on black backgrounds to stay white */
  .invoice-container [style*="background: #000"][style*="color: #fff"],
  .invoice-container [style*="background:#000"][style*="color:#fff"],
  .invoice-container [style*="background: #000"][style*="color: #ffffff"],
  .invoice-container [style*="background:#000"][style*="color:#ffffff"],
  .invoice-container [style*="background-color: #000"][style*="color: #fff"],
  .invoice-container [style*="background-color:#000"][style*="color:#fff"],
  .invoice-container [style*="background-color: #000"][style*="color: #ffffff"],
  .invoice-container [style*="background-color:#000"][style*="color:#ffffff"],
  .pdf-generation-temp [style*="background: #000"][style*="color: #fff"],
  .pdf-generation-temp [style*="background:#000"][style*="color:#fff"],
  .pdf-generation-temp [style*="background: #000"][style*="color: #ffffff"],
  .pdf-generation-temp [style*="background:#000"][style*="color:#ffffff"],
  .pdf-generation-temp [style*="background-color: #000"][style*="color: #fff"],
  .pdf-generation-temp [style*="background-color:#000"][style*="color:#fff"],
  .pdf-generation-temp [style*="background-color: #000"][style*="color: #ffffff"],
  .pdf-generation-temp [style*="background-color:#000"][style*="color:#ffffff"] {
    background-color: #000000 !important;
    background: #000000 !important;
    color: #ffffff !important;
  }

  /* Also protect children of black background elements - ensure white text stays white */
  .invoice-container [style*="background: #000"] *,
  .invoice-container [style*="background:#000"] *,
  .invoice-container [style*="background-color: #000"] *,
  .invoice-container [style*="background-color:#000"] *,
  .pdf-generation-temp [style*="background: #000"] *,
  .pdf-generation-temp [style*="background:#000"] *,
  .pdf-generation-temp [style*="background-color: #000"] *,
  .pdf-generation-temp [style*="background-color:#000"] * {
    /* If parent has black background, ensure background stays black */
    background-color: inherit !important;
    background: inherit !important;
  }

  /* CRITICAL: Ensure children of elements with black background and white text inherit white color */
  /* This fixes cases where child elements (like spans) don't have explicit color but should be white */
  .invoice-container [style*="background: #000"][style*="color: #fff"] *,
  .invoice-container [style*="background:#000"][style*="color:#fff"] *,
  .invoice-container [style*="background: #000"][style*="color: #ffffff"] *,
  .invoice-container [style*="background:#000"][style*="color:#ffffff"] *,
  .invoice-container [style*="background-color: #000"][style*="color: #fff"] *,
  .invoice-container [style*="background-color:#000"][style*="color:#fff"] *,
  .invoice-container [style*="background-color: #000"][style*="color: #ffffff"] *,
  .invoice-container [style*="background-color:#000"][style*="color:#ffffff"] *,
  .pdf-generation-temp [style*="background: #000"][style*="color: #fff"] *,
  .pdf-generation-temp [style*="background:#000"][style*="color:#fff"] *,
  .pdf-generation-temp [style*="background: #000"][style*="color: #ffffff"] *,
  .pdf-generation-temp [style*="background:#000"][style*="color:#ffffff"] *,
  .pdf-generation-temp [style*="background-color: #000"][style*="color: #fff"] *,
  .pdf-generation-temp [style*="background-color:#000"][style*="color:#fff"] *,
  .pdf-generation-temp [style*="background-color: #000"][style*="color: #ffffff"] *,
  .pdf-generation-temp [style*="background-color:#000"][style*="color:#ffffff"] * {
    /* Children should inherit white text color from parent */
    color: #ffffff !important;
    background-color: #000000 !important;
    background: #000000 !important;
  }

  /* CRITICAL: If child has white text color inline style, preserve it */
  .invoice-container [style*="background: #000"] [style*="color: #fff"],
  .invoice-container [style*="background:#000"] [style*="color:#fff"],
  .invoice-container [style*="background: #000"] [style*="color: #ffffff"],
  .invoice-container [style*="background:#000"] [style*="color:#ffffff"],
  .invoice-container [style*="background-color: #000"] [style*="color: #fff"],
  .invoice-container [style*="background-color:#000"] [style*="color:#fff"],
  .invoice-container [style*="background-color: #000"] [style*="color: #ffffff"],
  .invoice-container [style*="background-color:#000"] [style*="color:#ffffff"],
  .pdf-generation-temp [style*="background: #000"] [style*="color: #fff"],
  .pdf-generation-temp [style*="background:#000"] [style*="color:#fff"],
  .pdf-generation-temp [style*="background: #000"] [style*="color: #ffffff"],
  .pdf-generation-temp [style*="background:#000"] [style*="color:#ffffff"],
  .pdf-generation-temp [style*="background-color: #000"] [style*="color: #fff"],
  .pdf-generation-temp [style*="background-color:#000"] [style*="color:#fff"],
  .pdf-generation-temp [style*="background-color: #000"] [style*="color: #ffffff"],
  .pdf-generation-temp [style*="background-color:#000"] [style*="color:#ffffff"] {
    background-color: #000000 !important;
    background: #000000 !important;
    color: #ffffff !important;
  }

  /* Override any Tailwind dark mode background classes that might leak in */
  .invoice-container .dark\:bg-white,
  .invoice-container .dark\:bg-slate-50,
  .invoice-container .dark\:bg-slate-100,
  .invoice-container .dark\:bg-slate-200,
  .pdf-generation-temp .dark\:bg-white,
  .pdf-generation-temp .dark\:bg-slate-50,
  .pdf-generation-temp .dark\:bg-slate-100,
  .pdf-generation-temp .dark\:bg-slate-200 {
    /* Don't apply Tailwind dark mode backgrounds inside invoice containers */
    background-color: unset !important;
    background: unset !important;
  }

  /* Override any Tailwind dark mode text classes that might override white text */
  .invoice-container [style*="background: #000"] .dark\:text-slate-900,
  .invoice-container [style*="background:#000"] .dark\:text-slate-900,
  .invoice-container [style*="background-color: #000"] .dark\:text-slate-900,
  .invoice-container [style*="background-color:#000"] .dark\:text-slate-900,
  .pdf-generation-temp [style*="background: #000"] .dark\:text-slate-900,
  .pdf-generation-temp [style*="background:#000"] .dark\:text-slate-900,
  .pdf-generation-temp [style*="background-color: #000"] .dark\:text-slate-900,
  .pdf-generation-temp [style*="background-color:#000"] .dark\:text-slate-900 {
    /* Don't let Tailwind override white text on black backgrounds */
    color: #ffffff !important;
  }

  /* Note: Default dark text rule above handles elements without explicit colors */
  /* White-on-black protection rules below handle elements with black backgrounds */

  /* Specifically protect table headers and cells with black backgrounds */
  .invoice-container th[style*="background: #000"],
  .invoice-container th[style*="background:#000"],
  .invoice-container th[style*="background-color: #000"],
  .invoice-container th[style*="background-color:#000"],
  .invoice-container td[style*="background: #000"],
  .invoice-container td[style*="background:#000"],
  .invoice-container td[style*="background-color: #000"],
  .invoice-container td[style*="background-color:#000"],
  .pdf-generation-temp th[style*="background: #000"],
  .pdf-generation-temp th[style*="background:#000"],
  .pdf-generation-temp th[style*="background-color: #000"],
  .pdf-generation-temp th[style*="background-color:#000"],
  .pdf-generation-temp td[style*="background: #000"],
  .pdf-generation-temp td[style*="background:#000"],
  .pdf-generation-temp td[style*="background-color: #000"],
  .pdf-generation-temp td[style*="background-color:#000"] {
    background-color: #000000 !important;
    background: #000000 !important;
  }

  /* Ensure white text in table headers and cells stays white */
  .invoice-container th[style*="background: #000"][style*="color: #fff"],
  .invoice-container th[style*="background:#000"][style*="color:#fff"],
  .invoice-container td[style*="background: #000"][style*="color: #fff"],
  .invoice-container td[style*="background:#000"][style*="color:#fff"],
  .pdf-generation-temp th[style*="background: #000"][style*="color: #fff"],
  .pdf-generation-temp th[style*="background:#000"][style*="color:#fff"],
  .pdf-generation-temp td[style*="background: #000"][style*="color: #fff"],
  .pdf-generation-temp td[style*="background:#000"][style*="color:#fff"] {
    background-color: #000000 !important;
    background: #000000 !important;
    color: #ffffff !important;
  }
}

/* ============================================================================
   PRINT STYLES: Ensure invoices print correctly
   ============================================================================ */

@media print {
  @page {
    margin: 0;
    size: A4;
  }

  /* Force print color adjustment to preserve colors */
  .invoice-container,
  .invoice-container * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* Hide everything by default */
  body * {
    visibility: hidden;
  }

  /* Show only invoice print container and its invoice content */
  .invoice-print-container,
  .invoice-print-container .invoice-content-print,
  .invoice-print-container .invoice-content-print * {
    visibility: visible !important;
  }

  .invoice-print-container {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    margin: 0 !important;
    padding: 0 !important;
    background: white !important;
    z-index: 99999 !important;
  }

  /* Remove modal styling */
  .invoice-print-container>div {
    position: static !important;
    background: white !important;
    box-shadow: none !important;
    border-radius: 0 !important;
    max-width: 100% !important;
    width: 100% !important;
    height: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: visible !important;
  }

  /* Hide header and footer */
  .invoice-print-container>div>div:first-child,
  .invoice-print-container>div>div:last-child {
    display: none !important;
    visibility: hidden !important;
  }

  /* Position and size invoice content */
  .invoice-content-print {
    position: fixed !important;
    top: 0 !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    width: 210mm !important;
    height: auto !important;
    min-height: 297mm !important;
    margin: 0 !important;
    padding: 10mm !important;
    border: 0 !important;
    box-sizing: border-box !important;
    overflow: visible !important;
    background: white !important;
    page-break-after: avoid !important;
    page-break-inside: avoid !important;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* Scale the invoice content to fit - ensure all content is visible */
  .invoice-content-print>div {
    width: 100% !important;
    max-width: 100% !important;
    height: auto !important;
    transform-origin: top center !important;
    page-break-after: avoid !important;
    page-break-inside: avoid !important;
    overflow: visible !important;
  }

  /* Ensure PDF generation temp element is not affected by print CSS */
  .pdf-generation-temp,
  .pdf-generation-temp * {
    visibility: hidden !important;
  }

  .print\:hidden {
    display: none !important;
    visibility: hidden !important;
  }

  .print\:border-0 {
    border: 0 !important;
  }
}

/* ============================================================================
   TEMPLATE THUMBNAIL STYLES: For template selector previews
   ============================================================================ */

/**
 * General styles for all templates in thumbnail view
 * Uses attribute selectors to target any template class pattern
 * This works for all current and future templates without modification
 */

/* Target any element with a class ending in "-template" inside thumbnail wrapper */
.template-thumbnail-wrapper [class*="-template"] {
  padding: 40px !important;
  max-width: 800px !important;
  width: 800px !important;
}

/* Target any element with a class ending in "-header" inside thumbnail wrapper */
.template-thumbnail-wrapper [class*="-header"] {
  flex-direction: row !important;
}

/* Target any element with a class containing "grid" or "info-grid" */
.template-thumbnail-wrapper [class*="grid"],
.template-thumbnail-wrapper [class*="info-grid"],
.template-thumbnail-wrapper [class*="client-dates"],
.template-thumbnail-wrapper [class*="payment-notes"] {
  grid-template-columns: 1fr 1fr !important;
}

/* Target any element with a class containing "details" or "totals" */
.template-thumbnail-wrapper [class*="details"],
.template-thumbnail-wrapper [class*="totals"] {
  flex-direction: row !important;
}

/* Target any element with a class containing "company" or "profile" */
.template-thumbnail-wrapper [class*="company"],
.template-thumbnail-wrapper [class*="profile"] {
  margin-top: 0 !important;
}

/* Target any table inside thumbnail wrapper - ensure desktop layout */
/* CRITICAL: Override ALL responsive styles from template media queries */
.template-thumbnail-wrapper table {
  display: table !important;
  table-layout: fixed !important;
  width: 100% !important;
  border-collapse: collapse !important;
  font-size: inherit !important;
}

.template-thumbnail-wrapper table thead {
  display: table-header-group !important;
}

.template-thumbnail-wrapper table tbody {
  display: table-row-group !important;
}

.template-thumbnail-wrapper table thead tr,
.template-thumbnail-wrapper table tbody tr,
.template-thumbnail-wrapper table tr {
  display: table-row !important;
  width: 100% !important;
}

.template-thumbnail-wrapper table th,
.template-thumbnail-wrapper table td {
  display: table-cell !important;
}

/* Prevent vertical character stacking in scaled previews - force horizontal text */
.template-thumbnail-wrapper * {
  writing-mode: horizontal-tb !important;
  text-orientation: mixed !important;
  direction: ltr !important;
  -webkit-font-smoothing: antialiased !important;
  -moz-osx-font-smoothing: grayscale !important;
  text-rendering: optimizeLegibility !important;
}

/* CRITICAL: Override responsive table styles from template media queries */
/* Force desktop table layout regardless of viewport size */
.template-thumbnail-wrapper table[class*="-table"],
.template-thumbnail-wrapper .brutalist-table,
.template-thumbnail-wrapper .classic-table,
.template-thumbnail-wrapper .modern-table,
.template-thumbnail-wrapper .typewriter-table,
.template-thumbnail-wrapper .swiss-table,
.template-thumbnail-wrapper .professional-table,
.template-thumbnail-wrapper .minimal-japanese-table,
.template-thumbnail-wrapper .dark-mode-table,
.template-thumbnail-wrapper .neo-brutalist-table {
  display: table !important;
  table-layout: fixed !important;
  width: 100% !important;
  font-size: inherit !important;
}

.template-thumbnail-wrapper table[class*="-table"] thead,
.template-thumbnail-wrapper .brutalist-table thead,
.template-thumbnail-wrapper .classic-table thead,
.template-thumbnail-wrapper .modern-table thead,
.template-thumbnail-wrapper .typewriter-table thead,
.template-thumbnail-wrapper .swiss-table thead,
.template-thumbnail-wrapper .professional-table thead,
.template-thumbnail-wrapper .minimal-japanese-table thead,
.template-thumbnail-wrapper .dark-mode-table thead,
.template-thumbnail-wrapper .neo-brutalist-table thead {
  display: table-header-group !important;
}

.template-thumbnail-wrapper table[class*="-table"] tbody,
.template-thumbnail-wrapper .brutalist-table tbody,
.template-thumbnail-wrapper .classic-table tbody,
.template-thumbnail-wrapper .modern-table tbody,
.template-thumbnail-wrapper .typewriter-table tbody,
.template-thumbnail-wrapper .swiss-table tbody,
.template-thumbnail-wrapper .professional-table tbody,
.template-thumbnail-wrapper .minimal-japanese-table tbody,
.template-thumbnail-wrapper .dark-mode-table tbody,
.template-thumbnail-wrapper .neo-brutalist-table tbody {
  display: table-row-group !important;
}

.template-thumbnail-wrapper table[class*="-table"] tr,
.template-thumbnail-wrapper .brutalist-table tr,
.template-thumbnail-wrapper .classic-table tr,
.template-thumbnail-wrapper .modern-table tr,
.template-thumbnail-wrapper .typewriter-table tr,
.template-thumbnail-wrapper .swiss-table tr,
.template-thumbnail-wrapper .professional-table tr,
.template-thumbnail-wrapper .minimal-japanese-table tr,
.template-thumbnail-wrapper .dark-mode-table tr,
.template-thumbnail-wrapper .neo-brutalist-table tr {
  display: table-row !important;
  width: 100% !important;
}

.template-thumbnail-wrapper table[class*="-table"] th,
.template-thumbnail-wrapper table[class*="-table"] td,
.template-thumbnail-wrapper .brutalist-table th,
.template-thumbnail-wrapper .brutalist-table td,
.template-thumbnail-wrapper .classic-table th,
.template-thumbnail-wrapper .classic-table td,
.template-thumbnail-wrapper .modern-table th,
.template-thumbnail-wrapper .modern-table td,
.template-thumbnail-wrapper .typewriter-table th,
.template-thumbnail-wrapper .typewriter-table td,
.template-thumbnail-wrapper .swiss-table th,
.template-thumbnail-wrapper .swiss-table td,
.template-thumbnail-wrapper .professional-table th,
.template-thumbnail-wrapper .professional-table td,
.template-thumbnail-wrapper .minimal-japanese-table th,
.template-thumbnail-wrapper .minimal-japanese-table td,
.template-thumbnail-wrapper .dark-mode-table th,
.template-thumbnail-wrapper .dark-mode-table td,
.template-thumbnail-wrapper .neo-brutalist-table th,
.template-thumbnail-wrapper .neo-brutalist-table td {
  display: table-cell !important;
  padding: inherit !important;
  font-size: inherit !important;
}

/* CRITICAL: Force thead to respect column widths - prevent it from stretching full width */
.template-thumbnail-wrapper table thead {
  display: table-header-group !important;
  width: 100% !important;
}

.template-thumbnail-wrapper table thead tr {
  display: table-row !important;
  width: 100% !important;
}

/* CRITICAL: Set column widths on the first row (thead) to ensure table-layout: fixed works correctly */
/* With table-layout: fixed, column widths are determined by the first row */
/* These MUST be set on thead th to establish the column structure */
/* Use highly specific selectors to override template inline styles */
.template-thumbnail-wrapper table thead th:first-child,
.template-thumbnail-wrapper .brutalist-table thead th:first-child,
.template-thumbnail-wrapper .classic-table thead th:first-child,
.template-thumbnail-wrapper .modern-table thead th:first-child,
.template-thumbnail-wrapper .typewriter-table thead th:first-child,
.template-thumbnail-wrapper .swiss-table thead th:first-child,
.template-thumbnail-wrapper .professional-table thead th:first-child,
.template-thumbnail-wrapper .minimal-japanese-table thead th:first-child,
.template-thumbnail-wrapper .dark-mode-table thead th:first-child,
.template-thumbnail-wrapper .neo-brutalist-table thead th:first-child {
  width: 50% !important;
  min-width: 0 !important;
  max-width: 50% !important;
}

.template-thumbnail-wrapper table thead th:nth-child(2),
.template-thumbnail-wrapper .brutalist-table thead th:nth-child(2),
.template-thumbnail-wrapper .classic-table thead th:nth-child(2),
.template-thumbnail-wrapper .modern-table thead th:nth-child(2),
.template-thumbnail-wrapper .typewriter-table thead th:nth-child(2),
.template-thumbnail-wrapper .swiss-table thead th:nth-child(2),
.template-thumbnail-wrapper .professional-table thead th:nth-child(2),
.template-thumbnail-wrapper .minimal-japanese-table thead th:nth-child(2),
.template-thumbnail-wrapper .dark-mode-table thead th:nth-child(2),
.template-thumbnail-wrapper .neo-brutalist-table thead th:nth-child(2) {
  width: 15% !important;
  min-width: 0 !important;
  max-width: 15% !important;
}

.template-thumbnail-wrapper table thead th:nth-child(3),
.template-thumbnail-wrapper .brutalist-table thead th:nth-child(3),
.template-thumbnail-wrapper .classic-table thead th:nth-child(3),
.template-thumbnail-wrapper .modern-table thead th:nth-child(3),
.template-thumbnail-wrapper .typewriter-table thead th:nth-child(3),
.template-thumbnail-wrapper .swiss-table thead th:nth-child(3),
.template-thumbnail-wrapper .professional-table thead th:nth-child(3),
.template-thumbnail-wrapper .minimal-japanese-table thead th:nth-child(3),
.template-thumbnail-wrapper .dark-mode-table thead th:nth-child(3),
.template-thumbnail-wrapper .neo-brutalist-table thead th:nth-child(3) {
  width: 20% !important;
  min-width: 0 !important;
  max-width: 20% !important;
}

.template-thumbnail-wrapper table thead th:nth-child(4),
.template-thumbnail-wrapper .brutalist-table thead th:nth-child(4),
.template-thumbnail-wrapper .classic-table thead th:nth-child(4),
.template-thumbnail-wrapper .modern-table thead th:nth-child(4),
.template-thumbnail-wrapper .typewriter-table thead th:nth-child(4),
.template-thumbnail-wrapper .swiss-table thead th:nth-child(4),
.template-thumbnail-wrapper .professional-table thead th:nth-child(4),
.template-thumbnail-wrapper .minimal-japanese-table thead th:nth-child(4),
.template-thumbnail-wrapper .dark-mode-table thead th:nth-child(4),
.template-thumbnail-wrapper .neo-brutalist-table thead th:nth-child(4) {
  width: 15% !important;
  min-width: 0 !important;
  max-width: 15% !important;
}

/* Ensure description cells wrap properly in thumbnail preview */
/* Apply width to BOTH th and td for first column to ensure alignment */
/* Use specific selectors to override template responsive styles */
.template-thumbnail-wrapper table th:first-child,
.template-thumbnail-wrapper table td:first-child,
.template-thumbnail-wrapper .brutalist-table th:first-child,
.template-thumbnail-wrapper .brutalist-table td:first-child,
.template-thumbnail-wrapper .classic-table th:first-child,
.template-thumbnail-wrapper .classic-table td:first-child,
.template-thumbnail-wrapper .modern-table th:first-child,
.template-thumbnail-wrapper .modern-table td:first-child,
.template-thumbnail-wrapper .typewriter-table th:first-child,
.template-thumbnail-wrapper .typewriter-table td:first-child,
.template-thumbnail-wrapper .swiss-table th:first-child,
.template-thumbnail-wrapper .swiss-table td:first-child,
.template-thumbnail-wrapper .professional-table th:first-child,
.template-thumbnail-wrapper .professional-table td:first-child,
.template-thumbnail-wrapper .minimal-japanese-table th:first-child,
.template-thumbnail-wrapper .minimal-japanese-table td:first-child,
.template-thumbnail-wrapper .dark-mode-table th:first-child,
.template-thumbnail-wrapper .dark-mode-table td:first-child,
.template-thumbnail-wrapper .neo-brutalist-table th:first-child,
.template-thumbnail-wrapper .neo-brutalist-table td:first-child {
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
  white-space: normal !important;
  display: table-cell !important;
  vertical-align: top !important;
  writing-mode: horizontal-tb !important;
  text-orientation: mixed !important;
  /* Fixed width percentage to prevent character-by-character breaking */
  width: 50% !important;
  min-width: 0 !important;
  max-width: 50% !important;
  padding: 8px 12px !important;
  box-sizing: border-box !important;
}

/* Set widths for other columns to maintain table structure */
/* Ensure both headers and cells have matching widths */
.template-thumbnail-wrapper table th:nth-child(2),
.template-thumbnail-wrapper table td:nth-child(2),
.template-thumbnail-wrapper .brutalist-table th:nth-child(2),
.template-thumbnail-wrapper .brutalist-table td:nth-child(2),
.template-thumbnail-wrapper .classic-table th:nth-child(2),
.template-thumbnail-wrapper .classic-table td:nth-child(2),
.template-thumbnail-wrapper .modern-table th:nth-child(2),
.template-thumbnail-wrapper .modern-table td:nth-child(2),
.template-thumbnail-wrapper .typewriter-table th:nth-child(2),
.template-thumbnail-wrapper .typewriter-table td:nth-child(2),
.template-thumbnail-wrapper .swiss-table th:nth-child(2),
.template-thumbnail-wrapper .swiss-table td:nth-child(2),
.template-thumbnail-wrapper .professional-table th:nth-child(2),
.template-thumbnail-wrapper .professional-table td:nth-child(2),
.template-thumbnail-wrapper .minimal-japanese-table th:nth-child(2),
.template-thumbnail-wrapper .minimal-japanese-table td:nth-child(2),
.template-thumbnail-wrapper .dark-mode-table th:nth-child(2),
.template-thumbnail-wrapper .dark-mode-table td:nth-child(2),
.template-thumbnail-wrapper .neo-brutalist-table th:nth-child(2),
.template-thumbnail-wrapper .neo-brutalist-table td:nth-child(2) {
  width: 15% !important;
  min-width: 0 !important;
  max-width: 15% !important;
  padding: 8px 12px !important;
  box-sizing: border-box !important;
}

.template-thumbnail-wrapper table th:nth-child(3),
.template-thumbnail-wrapper table td:nth-child(3),
.template-thumbnail-wrapper .brutalist-table th:nth-child(3),
.template-thumbnail-wrapper .brutalist-table td:nth-child(3),
.template-thumbnail-wrapper .classic-table th:nth-child(3),
.template-thumbnail-wrapper .classic-table td:nth-child(3),
.template-thumbnail-wrapper .modern-table th:nth-child(3),
.template-thumbnail-wrapper .modern-table td:nth-child(3),
.template-thumbnail-wrapper .typewriter-table th:nth-child(3),
.template-thumbnail-wrapper .typewriter-table td:nth-child(3),
.template-thumbnail-wrapper .swiss-table th:nth-child(3),
.template-thumbnail-wrapper .swiss-table td:nth-child(3),
.template-thumbnail-wrapper .professional-table th:nth-child(3),
.template-thumbnail-wrapper .professional-table td:nth-child(3),
.template-thumbnail-wrapper .minimal-japanese-table th:nth-child(3),
.template-thumbnail-wrapper .minimal-japanese-table td:nth-child(3),
.template-thumbnail-wrapper .dark-mode-table th:nth-child(3),
.template-thumbnail-wrapper .dark-mode-table td:nth-child(3),
.template-thumbnail-wrapper .neo-brutalist-table th:nth-child(3),
.template-thumbnail-wrapper .neo-brutalist-table td:nth-child(3) {
  width: 20% !important;
  min-width: 0 !important;
  max-width: 20% !important;
  padding: 8px 12px !important;
  box-sizing: border-box !important;
}

.template-thumbnail-wrapper table th:nth-child(4),
.template-thumbnail-wrapper table td:nth-child(4),
.template-thumbnail-wrapper .brutalist-table th:nth-child(4),
.template-thumbnail-wrapper .brutalist-table td:nth-child(4),
.template-thumbnail-wrapper .classic-table th:nth-child(4),
.template-thumbnail-wrapper .classic-table td:nth-child(4),
.template-thumbnail-wrapper .modern-table th:nth-child(4),
.template-thumbnail-wrapper .modern-table td:nth-child(4),
.template-thumbnail-wrapper .typewriter-table th:nth-child(4),
.template-thumbnail-wrapper .typewriter-table td:nth-child(4),
.template-thumbnail-wrapper .swiss-table th:nth-child(4),
.template-thumbnail-wrapper .swiss-table td:nth-child(4),
.template-thumbnail-wrapper .professional-table th:nth-child(4),
.template-thumbnail-wrapper .professional-table td:nth-child(4),
.template-thumbnail-wrapper .minimal-japanese-table th:nth-child(4),
.template-thumbnail-wrapper .minimal-japanese-table td:nth-child(4),
.template-thumbnail-wrapper .dark-mode-table th:nth-child(4),
.template-thumbnail-wrapper .dark-mode-table td:nth-child(4),
.template-thumbnail-wrapper .neo-brutalist-table th:nth-child(4),
.template-thumbnail-wrapper .neo-brutalist-table td:nth-child(4) {
  width: 15% !important;
  min-width: 0 !important;
  max-width: 15% !important;
  padding: 8px 12px !important;
  box-sizing: border-box !important;
}

/* Prevent vertical character stacking in scaled previews */
.template-thumbnail-wrapper table td,
.template-thumbnail-wrapper table th {
  white-space: normal !important;
  word-break: break-word !important;
  display: table-cell !important;
  vertical-align: top !important;
  writing-mode: horizontal-tb !important;
  text-orientation: mixed !important;
  overflow: hidden !important;
  box-sizing: border-box !important;
  /* Prevent responsive styles from making cells full width */
  max-width: none !important;
}

/* CRITICAL: Prevent any responsive styles from overriding column structure */
/* Override any width: 100% rules that might come from responsive media queries */
.template-thumbnail-wrapper table th:not(:first-child):not(:nth-child(2)):not(:nth-child(3)):not(:nth-child(4)),
.template-thumbnail-wrapper table td:not(:first-child):not(:nth-child(2)):not(:nth-child(3)):not(:nth-child(4)) {
  width: auto !important;
}

/* For templates using div-based layouts (like ColorPopGridTemplate) */
.template-thumbnail-wrapper [style*="grid-template-columns"]>div:first-child,
.template-thumbnail-wrapper [style*="display: grid"]>div:first-child {
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
  white-space: normal !important;
}

/* Professional template totals table - prevent squashing in thumbnail preview */
.template-thumbnail-wrapper .professional-totals-table-container {
  width: auto !important;
  min-width: 200px !important;
  max-width: none !important;
}

.template-thumbnail-wrapper .professional-totals-table-container table {
  min-width: 200px !important;
  width: auto !important;
  table-layout: auto !important;
}

.template-thumbnail-wrapper .professional-currency-value {
  white-space: nowrap !important;
  min-width: 100px !important;
}

/* Classic template - prevent squashing of line item descriptions in thumbnail */
/* Override media query styles that reduce padding/font-size when viewport < 768px */
.template-thumbnail-wrapper .classic-table {
  table-layout: fixed !important;
  width: 100% !important;
  font-size: inherit !important;
}

.template-thumbnail-wrapper .classic-table th,
.template-thumbnail-wrapper .classic-table td {
  padding: 12px !important;
  font-size: inherit !important;
}

.template-thumbnail-wrapper .classic-table th:first-child,
.template-thumbnail-wrapper .classic-table td:first-child {
  width: 50% !important;
  min-width: 200px !important;
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
  white-space: normal !important;
}

.template-thumbnail-wrapper .classic-info-section {
  flex-direction: row !important;
  gap: 20px !important;
}

.template-thumbnail-wrapper .classic-info-section>div:first-child {
  max-width: 300px !important;
  min-width: 200px !important;
}

/* Modern template - prevent vertical text breaking in total value */
.template-thumbnail-wrapper .modern-totals-box {
  min-width: 200px !important;
  width: auto !important;
}

.template-thumbnail-wrapper .modern-totals-box table {
  table-layout: auto !important;
  width: 100% !important;
}

.template-thumbnail-wrapper .modern-totals-box td {
  white-space: nowrap !important;
  word-wrap: normal !important;
  overflow-wrap: normal !important;
}

.template-thumbnail-wrapper .modern-total-value {
  white-space: nowrap !important;
  word-wrap: normal !important;
  overflow-wrap: normal !important;
  writing-mode: horizontal-tb !important;
  text-orientation: mixed !important;
  direction: ltr !important;
  min-width: 100px !important;
}

.template-thumbnail-wrapper .modern-totals-value {
  white-space: nowrap !important;
  word-wrap: normal !important;
  overflow-wrap: normal !important;
  writing-mode: horizontal-tb !important;
  text-orientation: mixed !important;
  direction: ltr !important;
}

/* PDF-specific adjustments - general template adjustments */
.pdf-generation-temp [class*="-invoice-number"] {
  margin-top: 20px !important;
}